<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.event_bar_easv.dal.mappers.EventMapper">

    <resultMap id="eventResult" type="Event">
        <id property="eventId" column="eventId"/>
        <result property="eventName" column="eventName"/>
        <result property="startDate"  column="startDate"/>
        <result property="endDate"  column="endDate"/>
        <result property="location" column="location"/>
        <result property="description" column="description"/>
        <result property="createdAt"  column="createdAt"/>
        <result property="startTime"  column="startTime"/>
        <result property="endTime"  column="endTime"/>
        <collection property="participants" javaType="ArrayList" column="eventId" ofType="AppUser">
            <id property="id" column="userId"/>
            <result property="name" column="userName"/>
            <result property="email" column="userEmail"/>
        </collection>
        <collection property="ticketTypes" javaType="ArrayList" column="eventId" ofType="TicketType">
            <id property="id" column="typeId"/>
            <result property="type" column="typeName"/>
            <result property="benefit" column="typeBenefit"/>
        </collection>
    </resultMap>

    <!--    this bullshit does not map column names with kebab case psw_has -->
    <!--    so it needs to be casted -->
    <select id="getAllEvents"
            resultMap="eventResult">
        SELECT e.id          as eventId,
               e.event_name  as eventName,
               e.start_date  as startDate,
               e.end_date    as endDate,
               e.location as location,
               e.description as description,
               e.created_at  as createdAt,
               e.start_time  as startTime,
               e.end_time    as endTime,
               u.id          as userId,
               u.name        as userName,
               u.email       as userEmail,
               t.id          as typeId,
               t.type_name   as typeName,
               t.benefit     as typeBenefit
        FROM event AS e -->
                 LEFT OUTER JOIN user_event ue ON e.id = ue.event_id
                 LEFT OUTER JOIN app_user u ON ue.user_id = u.id
                 LEFT OUTER JOIN event_type et ON e.id = et.event_id
                 LEFT OUTER JOIN type t ON et.type_id = t.id;
    </select>

</mapper>



